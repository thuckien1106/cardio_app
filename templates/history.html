{% extends 'base.html' %}
{% block content %}
<div class="container mt-5 pt-4">
  <h2 class="fw-bold text-gradient mb-4">üìú L·ªãch s·ª≠ ch·∫©n ƒëo√°n</h2>
  <p class="text-muted">
    {% if session['role'] == 'doctor' %}
      Danh s√°ch k·∫øt qu·∫£ ch·∫©n ƒëo√°n c·ªßa t·∫•t c·∫£ b·ªánh nh√¢n.
    {% else %}
      L·ªãch s·ª≠ ch·∫©n ƒëo√°n c·ªßa b·∫°n.
    {% endif %}
  </p>

  {% if records and records|length > 0 %}
  <div class="table-responsive mt-4">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          {% if session['role'] == 'doctor' %}
            <th>B·ªánh nh√¢n</th>
          {% endif %}
          <th>Tu·ªïi</th>
          <th>Gi·ªõi t√≠nh</th>
          <th>BMI</th>
          <th>HATT</th>
          <th>HATTr</th>
          <th>Cholesterol</th>
          <th>ƒê∆∞·ªùng huy·∫øt</th>
          <th>H√∫t thu·ªëc</th>
          <th>U·ªëng c·ªìn</th>
          <th>T·∫≠p th·ªÉ d·ª•c</th>
          <th>Nguy c∆°</th>
          <th>Ng√†y ch·∫©n ƒëo√°n</th>
          <th class="text-center">X√≥a</th>
        </tr>
      </thead>
      <tbody>
        {% for r in records %}
        <tr>
          {% if session['role'] == 'doctor' %}
            <td>{{ r.TenBenhNhan }}</td>
          {% endif %}
          <td>{{ r.Tuoi if r.Tuoi is not none else '-' }}</td>
          <td>{{ r.GioiTinh if r.GioiTinh else '-' }}</td>
          <td>{{ r.BMI }}</td>
          <td>{{ r.HuyetApTamThu }}</td>
          <td>{{ r.HuyetApTamTruong }}</td>
          <td>{{ r.Cholesterol }}</td>
          <td>{{ r.DuongHuyet }}</td>
          <td>{{ 'C√≥' if r.HutThuoc else 'Kh√¥ng' }}</td>
          <td>{{ 'C√≥' if r.UongCon else 'Kh√¥ng' }}</td>
          <td>{{ 'C√≥' if r.TapTheDuc else 'Kh√¥ng' }}</td>
          <td>
            {% if 'cao' in r.NguyCo|lower %}
              <span class="badge bg-danger">{{ r.NguyCo }}</span>
            {% else %}
              <span class="badge bg-success">{{ r.NguyCo }}</span>
            {% endif %}
          </td>
          <td>{{ r.NgayChanDoan.strftime('%d/%m/%Y') }}</td>

          <!-- N√∫t X√≥a -->
          <td class="text-center">
            <form method="post" action="{{ url_for('delete_history', id=r.ChanDoanID) }}"
                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ch·∫©n ƒëo√°n n√†y kh√¥ng?');">
              <button type="submit" class="btn btn-sm btn-outline-danger">
                üóë X√≥a
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <div class="alert alert-info mt-4">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>
  {% endif %}
</div>
{% endblock %}
