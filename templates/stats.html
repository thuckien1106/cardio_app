{% extends 'base.html' %}
{% block content %}
<div class="container mt-5 pt-4">

  <h2 class="fw-bold text-gradient mb-4 text-center">ğŸ“Š Thá»‘ng kÃª Há»‡ thá»‘ng</h2>

  <!-- Thá»‘ng kÃª tá»•ng quan -->
  <div class="row text-center mb-5">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-primary">ğŸ‘¨â€âš•ï¸ Tá»•ng sá»‘ bÃ¡c sÄ©</h5>
          <h2 class="fw-bold">{{ num_doctors }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-success">ğŸ§‘â€ğŸ¤â€ğŸ§‘ Tá»•ng sá»‘ bá»‡nh nhÃ¢n</h5>
          <h2 class="fw-bold">{{ num_patients }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-warning">ğŸ©º Tá»•ng sá»‘ lÆ°á»£t cháº©n Ä‘oÃ¡n</h5>
          <h2 class="fw-bold">{{ num_diagnoses }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- VÃ¹ng chá»©a biá»ƒu Ä‘á»“ vá»›i data-* -->
  <div id="chartData"
       data-doctors="{{ num_doctors }}"
       data-patients="{{ num_patients }}"
       data-labels="{{ month_labels | join(',') }}"
       data-counts="{{ month_counts | join(',') }}">
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
          <h5 class="card-title text-center">Tá»· lá»‡ BÃ¡c sÄ© / Bá»‡nh nhÃ¢n</h5>
          <canvas id="pieChart"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
          <h5 class="card-title text-center">LÆ°á»£t cháº©n Ä‘oÃ¡n theo thÃ¡ng</h5>
          <canvas id="barChart"></canvas>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Láº¥y dá»¯ liá»‡u tá»« tháº» div
  const chartDiv = document.getElementById('chartData');
  const numDoctors = parseInt(chartDiv.dataset.doctors);
  const numPatients = parseInt(chartDiv.dataset.patients);
  const monthLabels = chartDiv.dataset.labels.split(',');
  const monthCounts = chartDiv.dataset.counts.split(',').map(Number);

  // ======================
  // Biá»ƒu Ä‘á»“ trÃ²n
  // ======================
  new Chart(document.getElementById('pieChart').getContext('2d'), {
    type: 'pie',
    data: {
      labels: ['BÃ¡c sÄ©', 'Bá»‡nh nhÃ¢n'],
      datasets: [{
        data: [numDoctors, numPatients],
        backgroundColor: ['#36A2EB', '#4CAF50']
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // ======================
  // Biá»ƒu Ä‘á»“ cá»™t
  // ======================
  new Chart(document.getElementById('barChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: monthLabels,
      datasets: [{
        label: 'Sá»‘ lÆ°á»£t cháº©n Ä‘oÃ¡n',
        data: monthCounts,
        backgroundColor: '#FF6384'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Sá»‘ lÆ°á»£t' } },
        x: { title: { display: true, text: 'ThÃ¡ng' } }
      }
    }
  });
</script>
{% endblock %}
