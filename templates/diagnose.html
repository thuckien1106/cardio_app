{% extends 'base.html' %}
{% block content %}
<div class="container mt-4 pt-3">

    <!-- Ti√™u ƒë·ªÅ -->
    <div class="text-center mb-4">
        <h2 class="fw-bold text-gradient">ü©∫ Ch·∫©n ƒëo√°n b·ªánh tim m·∫°ch</h2>
        <p class="text-muted small">
            {% if session['role'] == 'doctor' %}
                Ch·ªçn b·ªánh nh√¢n c·∫ßn ch·∫©n ƒëo√°n, sau ƒë√≥ nh·∫≠p d·ªØ li·ªáu c·∫ßn thi·∫øt.
            {% else %}
                Nh·∫≠p d·ªØ li·ªáu ho·∫∑c t·∫£i file CSV/Excel ƒë·ªÉ h·ªá th·ªëng d·ª± ƒëo√°n nguy c∆° m·∫Øc b·ªánh tim m·∫°ch.
            {% endif %}
        </p>
    </div>

    <div class="row g-3">

        <!-- ======== Form nh·∫≠p li·ªáu ======== -->
        <div class="col-lg-6">
            <div class="card shadow-sm p-4 border-0 rounded-4">
                <h4 class="text-primary mb-3">üìã Nh·∫≠p d·ªØ li·ªáu</h4>

                <form method="post">
                    <input type="hidden" name="predict_form" value="1">

                    <!-- N·∫øu l√† b√°c sƒ© ‚Üí ch·ªçn b·ªánh nh√¢n -->
                    {% if session['role'] == 'doctor' %}
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Ch·ªçn b·ªánh nh√¢n</label>
                        <select name="benhnhan_id" class="form-select" required>
                            <option value="">-- Ch·ªçn b·ªánh nh√¢n --</option>
                            {% for bn in benhnhans %}
                            <option value="{{ bn.ID }}">
                                {{ bn.HoTen }} | {{ bn.GioiTinh }} | {{ bn.NgaySinh }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <!-- Tu·ªïi / Gi·ªõi t√≠nh / T·∫≠p th·ªÉ d·ª•c -->
                    <div class="row g-2">
                        <div class="col-md-4">
                            <label class="form-label fw-semibold">Tu·ªïi</label>
                            <input type="number" name="age" class="form-control" required placeholder="VD: 45">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-semibold">Gi·ªõi t√≠nh</label>
                            <select name="gender" class="form-select" required>
                                <option value="Nam">Nam</option>
                                <option value="N·ªØ">N·ªØ</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-semibold">T·∫≠p th·ªÉ d·ª•c</label>
                            <select name="exercise" class="form-select">
                                <option value="yes">C√≥</option>
                                <option value="no">Kh√¥ng</option>
                            </select>
                        </div>
                    </div>

                    <!-- C√¢n n·∫∑ng / Chi·ªÅu cao -->
                    <div class="row g-2 mt-2">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">C√¢n n·∫∑ng (kg)</label>
                            <input type="number" step="0.1" name="weight" class="form-control" required placeholder="VD: 65.5">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Chi·ªÅu cao (cm)</label>
                            <input type="number" step="0.1" name="height" class="form-control" required placeholder="VD: 170">
                        </div>
                    </div>

                    <!-- Huy·∫øt √°p -->
                    <div class="row g-2 mt-2">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Huy·∫øt √°p t√¢m thu (HATT)</label>
                            <input type="number" name="systolic" class="form-control" required placeholder="VD: 130">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Huy·∫øt √°p t√¢m tr∆∞∆°ng (HATTr)</label>
                            <input type="number" name="diastolic" class="form-control" required placeholder="VD: 85">
                        </div>
                    </div>

                    <!-- Cholesterol / ƒê∆∞·ªùng huy·∫øt -->
                    <div class="row g-2 mt-2">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Cholesterol</label>
                            <select name="cholesterol" class="form-select">
                                <option value="normal">B√¨nh th∆∞·ªùng</option>
                                <option value="above_normal">Cao h∆°n b√¨nh th∆∞·ªùng</option>
                                <option value="high">Cao</option>
                            </select>
                            <small class="text-muted">VD: Cholesterol &gt; 5.2 mmol/L ‚Üí ch·ªçn "Cao"</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">ƒê∆∞·ªùng huy·∫øt</label>
                            <select name="glucose" class="form-select">
                                <option value="normal">B√¨nh th∆∞·ªùng</option>
                                <option value="above_normal">Cao h∆°n b√¨nh th∆∞·ªùng</option>
                                <option value="high">Cao</option>
                            </select>
                            <small class="text-muted">VD: Glucose &gt; 7.0 mmol/L ‚Üí ch·ªçn "Cao"</small>
                        </div>
                    </div>

                    <!-- H√∫t thu·ªëc / U·ªëng c·ªìn -->
                    <div class="row g-2 mt-2">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">H√∫t thu·ªëc</label>
                            <select name="smoking" class="form-select">
                                <option value="no">Kh√¥ng</option>
                                <option value="yes">C√≥</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">U·ªëng c·ªìn</label>
                            <select name="alcohol" class="form-select">
                                <option value="no">Kh√¥ng</option>
                                <option value="yes">C√≥</option>
                            </select>
                        </div>
                    </div>

                    <!-- N√∫t D·ª± ƒëo√°n -->
                    <button type="submit" class="btn btn-success w-100 rounded-pill mt-3">
                        üîç D·ª± ƒëo√°n
                    </button>
                </form>

                <!-- K·∫øt qu·∫£ d·ª± ƒëo√°n -->
                {% if result %}
                <div class="alert alert-info mt-3 rounded-3">
                    <strong>K·∫øt qu·∫£ d·ª± ƒëo√°n:</strong> {{ result }}
                </div>
                {% endif %}

                <!-- L·ªùi khuy√™n t·ª´ AI -->
                {% if ai_advice %}
                <div class="alert alert-success mt-3 rounded-3">
                    <h6 class="fw-bold text-success">ü§ñ L·ªùi khuy√™n t·ª´ AI:</h6>
                    <p style="white-space: pre-line;">{{ ai_advice }}</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ======== Upload file ======== -->
        <div class="col-lg-6">
            <div class="card shadow-sm p-4 border-0 rounded-4">
                <h4 class="text-primary mb-3">üìÇ T·∫£i file CSV/Excel</h4>
                <form method="post" enctype="multipart/form-data">
                    <input type="file" name="data_file" class="form-control mb-2" accept=".csv,.xlsx">
                    <button type="submit" class="btn btn-primary w-100 rounded-pill">
                        ‚¨ÜÔ∏è T·∫£i l√™n & D·ª± ƒëo√°n
                    </button>
                </form>

                {% if file_result %}
                <div class="mt-3">
                    <h5 class="fw-semibold">üìä K·∫øt qu·∫£ t·ª´ file:</h5>
                    <div class="table-responsive">{{ file_result|safe }}</div>
                </div>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}
